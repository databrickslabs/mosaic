<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GDAL Installation guide &mdash; Mosaic</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
      <link rel="stylesheet" href="../_static/fonts.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Using grid index systems in Mosaic" href="grid-indexes.html" />
    <link rel="prev" title="Installation guide" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Mosaic
              <img src="../_static/mosaic_logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../api/api.html">API Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="usage.html">Usage</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installation.html">Installation guide</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">GDAL Installation guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="grid-indexes.html">Using grid index systems in Mosaic</a></li>
<li class="toctree-l2"><a class="reference internal" href="grid-indexes-bng.html">BNG - British National Grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html">Quickstart notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="kepler.html">Kepler visualizations</a></li>
<li class="toctree-l2"><a class="reference internal" href="automatic-sql-registration.html">Automatic SQL registration</a></li>
<li class="toctree-l2"><a class="reference internal" href="raster-checkpointing.html">Checkpointing for raster operations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../models/models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../literature/videos.html">Mosaic Videos and Talks</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Mosaic</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="usage.html">Usage</a></li>
      <li class="breadcrumb-item active">GDAL Installation guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/usage/install-gdal.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="gdal-installation-guide">
<h1>GDAL Installation guide<a class="headerlink" href="#gdal-installation-guide" title="Permalink to this heading"></a></h1>
<section id="supported-platforms">
<h2>Supported platforms<a class="headerlink" href="#supported-platforms" title="Permalink to this heading"></a></h2>
<p>In order to use Mosaic 0.4 series, you must have access to a Databricks cluster running
Databricks Runtime 13.3 LTS.
If you have cluster creation permissions in your Databricks
workspace, you can create a cluster using the instructions
<a class="reference external" href="https://docs.databricks.com/clusters/create.html#use-the-cluster-ui">here</a>.</p>
<p>You will also need “Can Manage” permissions on this cluster in order to attach the
Mosaic library to your cluster. A workspace administrator will be able to grant
these permissions and more information about cluster permissions can be found
in our documentation
<a class="reference external" href="https://docs.databricks.com/security/access-control/cluster-acl.html#cluster-level-permissions">here</a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>These instructions assume an Assigned cluster is being used (vs a Shared Access cluster),
more on access modes <a class="reference external" href="https://docs.databricks.com/en/compute/configure.html#access-modes">here</a>.</p>
</div>
</section>
<section id="gdal-installation">
<h2>GDAL Installation<a class="headerlink" href="#gdal-installation" title="Permalink to this heading"></a></h2>
<section id="setup-gdal-files-and-scripts">
<h3>Setup GDAL files and scripts<a class="headerlink" href="#setup-gdal-files-and-scripts" title="Permalink to this heading"></a></h3>
<p>Mosaic requires GDAL to be installed on the cluster. The easiest way to do this is to use the
the <code class="code docutils literal notranslate"><span class="pre">setup_gdal</span></code> function.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>This is close in behavior to Mosaic &lt; 0.4 series (prior to DBR 13), it installs jammy default GDAL (3.4.1).</p></li>
<li><p>Param <strong>to_fuse_dir</strong> can be one of <strong>/Volumes/..</strong>, <strong>/Workspace/..</strong>, <strong>/dbfs/..</strong>;
however, you should consider <code class="code docutils literal notranslate"><span class="pre">setup_fuse_install()</span></code> for Volume based installs as that
exposes more options, to include copying JAR and JNI Shared Objects.</p></li>
</ul>
</div>
<dl class="py function">
<dt class="sig sig-object py" id="setup_gdal">
<span class="sig-name descname"><span class="pre">setup_gdal</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#setup_gdal" title="Permalink to this definition"></a></dt>
<dd><p>Generate an init script that will install GDAL native libraries on each worker node.
All of the listed parameters are optional. You can have even more control with <code class="code docutils literal notranslate"><span class="pre">setup_fuse_install</span></code> function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>to_fuse_dir</strong> (<em>str</em>) – Path to write out the init script for GDAL installation;
default is “/Workspace/Shared/geospatial/mosaic/gdal/jammy”.</p></li>
<li><p><strong>script_out_name</strong> (<em>str</em>) – Name of the script to be written; default is “mosaic-gdal-init.sh”.</p></li>
<li><p><strong>jni_so_copy</strong> (<em>bool</em>) – Whether to copy shared object to fuse dir and config script to use; default is False.</p></li>
</ul>
</dd>
<dt class="field-even">Example<span class="colon">:</span></dt>
<dd class="field-even"><p></p></dd>
</dl>
</dd></dl>

<div class="highlight-py notranslate"><div class="highlight"><pre><span></span>import mosaic as mos

mos.enable_mosaic(spark, dbutils)
mos.setup_gdal()

+-----------------------------------------------------------------------------------------------------------+
| ::: Install setup complete :::                                                                            |
+-----------------------------------------------------------------------------------------------------------+
| - Settings: &#39;jar_copy&#39;? False, &#39;jni_so_copy&#39;? False                      |
| - Fuse Dir: &#39;/Workspace/Shared/geospatial/mosaic/gdal/jammy&#39;                                              |
| - Init Script: configured and stored at &#39;mosaic-gdal-init.sh&#39;; add to your cluster and restart,           |
|               more at https://docs.databricks.com/en/init-scripts/cluster-scoped.html                     |
+-----------------------------------------------------------------------------------------------------------+
</pre></div>
</div>
</section>
<section id="configure-the-init-script">
<h3>Configure the init script<a class="headerlink" href="#configure-the-init-script" title="Permalink to this heading"></a></h3>
<p>After the <code class="code docutils literal notranslate"><span class="pre">setup_gdal</span></code> function has been run, you will need to configure the cluster to use the
init script. The init script can be set by clicking on the “Edit” button on the cluster page and adding
the following to the “Advanced Options” section:</p>
<figure class="doc-figure align-default" id="id1">
<img alt="../_images/init_script.png" src="../_images/init_script.png" />
<figcaption>
<p><span class="caption-text">Fig 1. Init script configuration</span><a class="headerlink" href="#id1" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="enable-gdal-for-a-notebook">
<h3>Enable GDAL for a notebook<a class="headerlink" href="#enable-gdal-for-a-notebook" title="Permalink to this heading"></a></h3>
<p>Once the cluster has been restarted, you can enable GDAL for a notebook by running the following
code at the top of the notebook:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mosaic</span> <span class="k">as</span> <span class="nn">mos</span>

<span class="n">mos</span><span class="o">.</span><span class="n">enable_mosaic</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="n">dbutils</span><span class="p">)</span>
<span class="n">mos</span><span class="o">.</span><span class="n">enable_gdal</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>GDAL enabled.
GDAL 3.4.1, released 2021/12/27
</pre></div>
</div>
</section>
</section>
<section id="gdal-configuration">
<h2>GDAL Configuration<a class="headerlink" href="#gdal-configuration" title="Permalink to this heading"></a></h2>
<p>Here are spark session configs available for raster, e.g. <code class="code docutils literal notranslate"><span class="pre">spark.conf.set(&quot;&lt;key&gt;&quot;,</span> <span class="pre">&quot;&lt;val&gt;&quot;)</span></code>.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Config</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>spark.databricks.labs.mosaic.raster.checkpoint</p></td>
<td><p>“/dbfs/tmp/mosaic/raster/checkpoint”</p></td>
<td><p>Checkpoint location, e.g. <a class="reference internal" href="../api/raster-functions.html#rst-maketiles"><span class="std std-ref">rst_maketiles</span></a></p></td>
</tr>
<tr class="row-odd"><td><p>spark.databricks.labs.mosaic.raster.use.checkpoint</p></td>
<td><p>“false”</p></td>
<td><p>Checkpoint for session, in 0.4.3+</p></td>
</tr>
<tr class="row-even"><td><p>spark.databricks.labs.mosaic.raster.tmp.prefix</p></td>
<td><p>“” (will use “/tmp”)</p></td>
<td><p>Local directory for workers</p></td>
</tr>
<tr class="row-odd"><td><p>spark.databricks.labs.mosaic.raster.blocksize</p></td>
<td><p>“128”</p></td>
<td><p>Blocksize in pixels, see <a class="reference internal" href="../api/raster-functions.html#rst-convolve"><span class="std std-ref">rst_convolve</span></a> and <a class="reference internal" href="../api/raster-functions.html#rst-filter"><span class="std std-ref">rst_filter</span></a> for more</p></td>
</tr>
</tbody>
</table>
<p>GDAL is configured as follows in <a class="reference external" href="https://github.com/databrickslabs/mosaic/blob/main/src/main/scala/com/databricks/labs/mosaic/gdal/MosaicGDAL.scala">MosaicGDAL</a> class:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Config</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>GDAL_VRT_ENABLE_PYTHON</p></td>
<td><p>“YES”</p></td>
</tr>
<tr class="row-odd"><td><p>GDAL_DISABLE_READDIR_ON_OPEN</p></td>
<td><p>“EMPTY_DIR”</p></td>
</tr>
<tr class="row-even"><td><p>CPL_TMPDIR</p></td>
<td><p>“&lt;CPL_TMPDIR&gt;”</p></td>
</tr>
<tr class="row-odd"><td><p>GDAL_PAM_PROXY_DIR</p></td>
<td><p>“&lt;GDAL_PAM_PROXY_DIR&gt;”</p></td>
</tr>
<tr class="row-even"><td><p>GDAL_PAM_ENABLED</p></td>
<td><p>“YES”</p></td>
</tr>
<tr class="row-odd"><td><p>CPL_VSIL_USE_TEMP_FILE_FOR_RANDOM_WRITE</p></td>
<td><p>“NO”</p></td>
</tr>
<tr class="row-even"><td><p>CPL_LOG</p></td>
<td><p>“&lt;CPL_TMPDIR&gt;/gdal.log”</p></td>
</tr>
<tr class="row-odd"><td><p>GDAL_CACHEMAX</p></td>
<td><p>“512”</p></td>
</tr>
<tr class="row-even"><td><p>GDAL_NUM_THREADS</p></td>
<td><p>“ALL_CPUS”</p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="grid-indexes.html" class="btn btn-neutral float-right" title="Using grid index systems in Mosaic" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Databricks Inc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>