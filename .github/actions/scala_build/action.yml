name: build mosaic scala
description: build mosaic scala
inputs:
  skip_tests:
    description: 'Skip Scala Tests? true or false'
    default: 'false'
runs:
  using: "composite"
  steps:
        - name: Configure JDK
          uses: actions/setup-java@v2
          with:
            java-version: '8'
            distribution: 'zulu'
        - name: Configure python interpreter
          shell: bash
          run: |
            pip install numpy==${{ matrix.numpy }}
            sudo bash <<EOF
              add-apt-repository ppa:deadsnakes/ppa
              apt update
              apt install -y python${{ matrix.python_minor }} \
              python${{ matrix.python_minor }}-dev \
              python${{ matrix.python_minor }}-venv \
              python${{ matrix.python_minor }}-distutils
              mkdir -p /databricks
              chown $USER:$USER /databricks
              chmod -R 766 /databricks/
            EOF
            python${{ matrix.python_minor }} -m venv /databricks/python3
        - name: Add packaged GDAL dependencies
          shell: bash
          run : |
            cd python && /databricks/python3/bin/pip install .
    #            echo "/databricks/python3/bin" >> "$GITHUB_PATH"
        - name: Test and build the scala JAR - skip tests is false
          if: inputs.skip_tests == 'false'
          shell: bash
          run: |
            readlink -f $(which python3)
            sudo update-alternatives --install /usr/bin/python3 python3 /databricks/python3/bin/python3 1
            readlink -f $(which python3)
            /databricks/python3/bin/python3 -c 'import numpy as np; print(np.__version__)'
            python3 -c 'import numpy as np; print(np.__version__)'
            sudo mvn -q clean install
        - name: Build the scala JAR - skip tests is true
          if: inputs.skip_tests == 'true'
          shell: bash
          run: sudo mvn -q clean install -DskipTests -Dscoverage.skip
        - name: Copy Scala artifacts to GH Actions run
          shell: bash
          run: |
            mkdir staging
            cp target/mosaic*.jar staging
