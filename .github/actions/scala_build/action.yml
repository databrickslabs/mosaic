name: build mosaic scala
description: build mosaic scala
inputs:
  skip_tests:
    description: 'Skip Scala Tests? true or false'
    default: 'false'
runs:
  using: "composite"
  steps:
        - name: Configure JDK
          uses: actions/setup-java@v2
          with:
            java-version: '8'
            distribution: 'zulu'
        - name: Configure python interpreter
#          uses: actions/setup-python@v2
#          with:
#            python-version:
          shell: bash
          run: |
            sudo bash <<EOF
              add-apt-repository ppa:deadsnakes/ppa
              apt update
              apt install -y python${{ matrix.python_minor }} \
              python${{ matrix.python_minor }}-dev \
              python${{ matrix.python_minor }}-venv \
              python${{ matrix.python_minor }}-distutils
              update-alternatives --install /usr/bin/python3 python3 /usr/bin/python${{ matrix.python_minor }} 1
              mkdir -p /databricks
              chmod -R 766 /databricks/
            EOF
            python3 -m venv /databricks/python3
            echo "/databricks/python3" >> "$GITHUB_PATH"
        - name: Add packaged GDAL dependencies
          shell: bash
          run : |
            which python
            cd python && pip install .
#            sudo dpkg -i python/mosaic/gdal/gdal_3.10.0-1_amd64.deb || :
#            sudo apt-get update && sudo apt-get install -f -y
#            sudo dpkg -i python/mosaic/gdal/gdal_3.10.0-1_amd64.deb
#            sudo dpkg -L gdal
#            sudo apt-get install -y python3-numpy zip unzip
        - name: Test and build the scala JAR - skip tests is false
          if: inputs.skip_tests == 'false'
          shell: bash
          run: sudo mvn -q clean install
        - name: Build the scala JAR - skip tests is true
          if: inputs.skip_tests == 'true'
          shell: bash
          run: sudo mvn -q clean install -DskipTests -Dscoverage.skip
        - name: Copy Scala artifacts to GH Actions run
          shell: bash
          run: |
            mkdir staging
            cp target/mosaic*.jar staging
