<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vector Format Readers &mdash; Mosaic</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
      <link rel="stylesheet" href="../_static/fonts.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/tabs.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Raster Format Readers" href="raster-format-readers.html" />
    <link rel="prev" title="API Documentation" href="api.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Mosaic
              <img src="../_static/mosaic_logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="api.html">API Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Vector Format Readers</a></li>
<li class="toctree-l2"><a class="reference internal" href="raster-format-readers.html">Raster Format Readers</a></li>
<li class="toctree-l2"><a class="reference internal" href="geometry-constructors.html">Geometry constructors</a></li>
<li class="toctree-l2"><a class="reference internal" href="geometry-accessors.html">Geometry accessors</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial-functions.html">Spatial functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial-indexing.html">Spatial grid indexing</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial-predicates.html">Spatial predicates</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial-aggregations.html">Spatial aggregation functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="raster-functions.html">Raster functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="rasterio-gdal-udfs.html">Rasterio + GDAL UDFs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../usage/usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../models/models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../literature/videos.html">Mosaic Videos and Talks</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Mosaic</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="api.html">API Documentation</a></li>
      <li class="breadcrumb-item active">Vector Format Readers</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/api/vector-format-readers.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="vector-format-readers">
<h1>Vector Format Readers<a class="headerlink" href="#vector-format-readers" title="Permalink to this heading"></a></h1>
<section id="intro">
<h2>Intro<a class="headerlink" href="#intro" title="Permalink to this heading"></a></h2>
<p>Mosaic provides spark readers for vector files supported by GDAL OGR drivers.
Only the drivers that are built by default are supported.
Here are some common useful file formats:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://gdal.org/drivers/vector/geojson.html">GeoJSON</a> (also <a class="reference external" href="https://gdal.org/drivers/vector/esrijson.html">ESRIJSON</a>,
<a class="reference external" href="https://gdal.org/drivers/vector/topojson.html">TopoJSON</a>)</p></li>
<li><p><a class="reference external" href="https://gdal.org/drivers/vector/filegdb.html">FileGDB</a> (ESRI File Geodatabase) and <a class="reference external" href="https://gdal.org/drivers/vector/openfilegdb.html">OpenFileGDB</a> (ESRI File Geodatabase vector) - Mosaic implements named reader <a class="reference internal" href="#spark-read-format-geo-db"><span class="std std-ref">spark.read.format(“geo_db”)</span></a> (described in this doc).</p></li>
<li><p><a class="reference external" href="https://gdal.org/drivers/vector/shapefile.html">ESRI Shapefile</a> (ESRI Shapefile / DBF) - Mosaic implements named reader <a class="reference internal" href="#spark-read-format-shapefile"><span class="std std-ref">spark.read.format(“shapefile”)</span></a> (described in this doc).</p></li>
<li><p><a class="reference external" href="https://gdal.org/drivers/raster/netcdf.html">netCDF</a> (Network Common Data Form) - Mosaic supports GDAL netCDF raster reader also.</p></li>
<li><p><a class="reference external" href="https://gdal.org/drivers/vector/xlsx.html">XLSX</a>, <a class="reference external" href="https://gdal.org/drivers/vector/xls.html">XLS</a>, <a class="reference external" href="https://gdal.org/drivers/vector/ods.html">ODS</a> spreadsheets</p></li>
<li><p><a class="reference external" href="https://gdal.org/drivers/vector/tiger.html">TIGER</a> (U.S. Census TIGER/Line)</p></li>
<li><p><a class="reference external" href="https://gdal.org/drivers/vector/pgdump.html">PGDump</a> (PostgreSQL Dump)</p></li>
<li><p><a class="reference external" href="https://gdal.org/drivers/vector/kml.html">KML</a> (Keyhole Markup Language)</p></li>
<li><p><a class="reference external" href="https://gdal.org/drivers/vector/gml.html">GML</a> (Geography Markup Language)</p></li>
<li><p><a class="reference external" href="https://gdal.org/drivers/vector/grass.html">GRASS</a> - option for Linear Referencing Systems (LRS)</p></li>
</ul>
</div></blockquote>
<p>For more information please refer to gdal <a class="reference external" href="https://gdal.org/drivers/vector/index.html">vector driver</a> documentation.</p>
<p>Mosaic provides two flavors of the general readers:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">spark.read.format(&quot;ogr&quot;)</span></code> for reading 1 file per spark task</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">mos.read().format(&quot;multi_read_ogr&quot;)</span></code> for reading file in parallel with multiple spark tasks</p></li>
</ul>
</div></blockquote>
<p>Additionally, for convenience, Mosaic provides specific readers for Shapefile and File Geodatabases:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">spark.read.format(&quot;geo_db&quot;)</span></code> reader for GeoDB files natively in Spark.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">spark.read.format(&quot;shapefile&quot;)</span></code> reader for Shapefiles natively in Spark.</p></li>
</ul>
</div></blockquote>
<section id="spark-read-format-ogr">
<h3>spark.read.format(“ogr”)<a class="headerlink" href="#spark-read-format-ogr" title="Permalink to this heading"></a></h3>
<p>A base Spark SQL data source for reading GDAL vector data sources.
The output of the reader is a DataFrame with inferred schema.
The schema is inferred from both features and fields in the vector file.
Each feature will be provided as 2 columns:</p>
<ul class="simple">
<li><p>geometry - geometry of the feature (GeometryType)</p></li>
<li><p>srid - spatial reference system identifier of the feature (StringType)</p></li>
</ul>
<p>The fields of the feature will be provided as columns in the DataFrame.
The types of the fields are coerced to most concrete type that can hold all the values.
The reader supports the following options:</p>
<blockquote>
<div><ul class="simple">
<li><p>driverName - GDAL driver name (StringType)</p></li>
<li><p>vsizip - if the vector files are zipped files, set this to true (BooleanType)</p></li>
<li><p>asWKB - if the geometry should be returned as WKB (BooleanType) - default is false</p></li>
<li><p>layerName - name of the layer to read (StringType)</p></li>
<li><p>layerNumber - number of the layer to read (IntegerType), zero-indexed</p></li>
</ul>
</div></blockquote>
<dl class="py function">
<dt class="sig sig-object py" id="spark.read.format-ogr-.load">
<span class="sig-prename descclassname"><span class="pre">spark.read.format(&quot;ogr&quot;).</span></span><span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#spark.read.format-ogr-.load" title="Permalink to this definition"></a></dt>
<dd><p>Loads a vector file and returns the result as a <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>path</strong> (<em>Column</em><em>(</em><em>StringType</em><em>)</em>) – the path of the vector file</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</dd>
<dt class="field-odd">Example<span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
</dd></dl>

<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-0-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-0-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-0-U2NhbGE=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-0-U2NhbGE=" name="U2NhbGE=" role="tab" tabindex="-1">Scala</button></div><div aria-labelledby="tab-0-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" id="panel-0-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;ogr&quot;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;driverName&quot;</span><span class="p">,</span> <span class="s2">&quot;GeoJSON&quot;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;layerName&quot;</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;asWKB&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;file:///tmp/points.geojson&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="o">+--------------------+-------+-----+-----------------+-----------+</span>
<span class="o">|</span>             <span class="n">field_1</span><span class="o">|</span><span class="n">field_2</span><span class="o">|</span> <span class="o">...</span> <span class="o">|</span>           <span class="n">geom_1</span><span class="o">|</span><span class="n">geom_1_srid</span><span class="o">|</span>
<span class="o">+--------------------+-------+-----+-----------------+-----------+</span>
<span class="o">|</span>       <span class="s2">&quot;description&quot;</span><span class="o">|</span>      <span class="mi">1</span><span class="o">|</span> <span class="o">...</span> <span class="o">|</span> <span class="n">POINT</span> <span class="p">(</span><span class="mf">1.0</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">|</span>       <span class="mi">4326</span><span class="o">|</span>
<span class="o">|</span>       <span class="s2">&quot;description&quot;</span><span class="o">|</span>      <span class="mi">2</span><span class="o">|</span> <span class="o">...</span> <span class="o">|</span> <span class="n">POINT</span> <span class="p">(</span><span class="mf">2.0</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">|</span>       <span class="mi">4326</span><span class="o">|</span>
<span class="o">|</span>       <span class="s2">&quot;description&quot;</span><span class="o">|</span>      <span class="mi">3</span><span class="o">|</span> <span class="o">...</span> <span class="o">|</span> <span class="n">POINT</span> <span class="p">(</span><span class="mf">3.0</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">|</span>       <span class="mi">4326</span><span class="o">|</span>
<span class="o">+--------------------+-------+-----+-----------------+-----------+</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-U2NhbGE=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-0-U2NhbGE=" name="U2NhbGE=" role="tabpanel" tabindex="0"><div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;ogr&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">&quot;layerName&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;points&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">&quot;asWKB&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;file:///tmp/points.geojson&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
<span class="o">+--------------------+-------+-----+-----------------+-----------+</span>
<span class="o">|</span><span class="w">             </span><span class="n">field_1</span><span class="o">|</span><span class="n">field_2</span><span class="o">|</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="n">geom_1</span><span class="o">|</span><span class="n">geom_1_srid</span><span class="o">|</span>
<span class="o">+--------------------+-------+-----+-----------------+-----------+</span>
<span class="o">|</span><span class="w">       </span><span class="s">&quot;description&quot;</span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="o">|</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nc">POINT</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">4326</span><span class="o">|</span>
<span class="o">|</span><span class="w">       </span><span class="s">&quot;description&quot;</span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="o">|</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nc">POINT</span><span class="w"> </span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="mf">2.0</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">4326</span><span class="o">|</span>
<span class="o">|</span><span class="w">       </span><span class="s">&quot;description&quot;</span><span class="o">|</span><span class="w">      </span><span class="mi">3</span><span class="o">|</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nc">POINT</span><span class="w"> </span><span class="p">(</span><span class="mf">3.0</span><span class="w"> </span><span class="mf">3.0</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">4326</span><span class="o">|</span>
<span class="o">+--------------------+-------+-----+-----------------+-----------+</span>
</pre></div>
</div>
</div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Keyword options not identified in function signature are converted to a <code class="code docutils literal notranslate"><span class="pre">Map&lt;String,String&gt;</span></code>.
These must be supplied as a <code class="code docutils literal notranslate"><span class="pre">String</span></code>.
Also, you can supply function signature values as <code class="code docutils literal notranslate"><span class="pre">String</span></code>.</p>
</div>
</section>
<section id="mos-read-format-multi-read-ogr">
<h3>mos.read().format(“multi_read_ogr”)<a class="headerlink" href="#mos-read-format-multi-read-ogr" title="Permalink to this heading"></a></h3>
<p>Mosaic supports reading vector files in parallel with multiple spark tasks.
The amount of data per task is controlled by the chunkSize option.
Chunk size is the number of file rows that will be read per single task.
The output of the reader is a DataFrame with inferred schema.
The schema is inferred from both features and fields in the vector file.
Each feature will be provided as 2 columns:</p>
<blockquote>
<div><ul class="simple">
<li><p>geometry - geometry of the feature (GeometryType)</p></li>
<li><p>srid - spatial reference system identifier of the feature (StringType)</p></li>
</ul>
</div></blockquote>
<p>The fields of the feature will be provided as columns in the DataFrame.
The types of the fields are coerced to most concrete type that can hold all the values.
ALL options should be passed as String as they are provided as a <code class="code docutils literal notranslate"><span class="pre">Map&lt;String,String&gt;</span></code>
and parsed into expected types on execution. The reader supports the following options:</p>
<blockquote>
<div><ul class="simple">
<li><p>driverName - GDAL driver name (StringType)</p></li>
<li><p>vsizip - if the vector files are zipped files, set this to true (BooleanType) [pass as String]</p></li>
<li><p>asWKB - if the geometry should be returned as WKB (BooleanType) - default is false [pass as String]</p></li>
<li><p>chunkSize - size of the chunk to read from the file per single task (IntegerType) - default is 5000 [pass as String]</p></li>
<li><p>layerName - name of the layer to read (StringType)</p></li>
<li><p>layerNumber - number of the layer to read (IntegerType), zero-indexed [pass as String]</p></li>
</ul>
</div></blockquote>
<dl class="py function">
<dt class="sig sig-object py" id="mos.read-.format-multi_read_ogr-.load">
<span class="sig-prename descclassname"><span class="pre">mos.read().format(&quot;multi_read_ogr&quot;).</span></span><span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mos.read-.format-multi_read_ogr-.load" title="Permalink to this definition"></a></dt>
<dd><p>Loads a vector file and returns the result as a <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>path</strong> (<em>Column</em><em>(</em><em>StringType</em><em>)</em>) – the path of the vector file</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</dd>
<dt class="field-odd">Example<span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
</dd></dl>

<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-1-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-1-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-1-U2NhbGE=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-1-U2NhbGE=" name="U2NhbGE=" role="tab" tabindex="-1">Scala</button></div><div aria-labelledby="tab-1-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" id="panel-1-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">mos</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;multi_read_ogr&quot;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;driverName&quot;</span><span class="p">,</span> <span class="s2">&quot;GeoJSON&quot;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;layerName&quot;</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;asWKB&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;file:///tmp/points.geojson&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="o">+--------------------+-------+-----+-----------------+-----------+</span>
<span class="o">|</span>             <span class="n">field_1</span><span class="o">|</span><span class="n">field_2</span><span class="o">|</span> <span class="o">...</span> <span class="o">|</span>           <span class="n">geom_1</span><span class="o">|</span><span class="n">geom_1_srid</span><span class="o">|</span>
<span class="o">+--------------------+-------+-----+-----------------+-----------+</span>
<span class="o">|</span>       <span class="s2">&quot;description&quot;</span><span class="o">|</span>      <span class="mi">1</span><span class="o">|</span> <span class="o">...</span> <span class="o">|</span> <span class="n">POINT</span> <span class="p">(</span><span class="mf">1.0</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">|</span>       <span class="mi">4326</span><span class="o">|</span>
<span class="o">|</span>       <span class="s2">&quot;description&quot;</span><span class="o">|</span>      <span class="mi">2</span><span class="o">|</span> <span class="o">...</span> <span class="o">|</span> <span class="n">POINT</span> <span class="p">(</span><span class="mf">2.0</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">|</span>       <span class="mi">4326</span><span class="o">|</span>
<span class="o">|</span>       <span class="s2">&quot;description&quot;</span><span class="o">|</span>      <span class="mi">3</span><span class="o">|</span> <span class="o">...</span> <span class="o">|</span> <span class="n">POINT</span> <span class="p">(</span><span class="mf">3.0</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">|</span>       <span class="mi">4326</span><span class="o">|</span>
<span class="o">+--------------------+-------+-----+-----------------+-----------+</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-1-U2NhbGE=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-1-U2NhbGE=" name="U2NhbGE=" role="tabpanel" tabindex="0"><div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">MosaicContext</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;multi_read_ogr&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">&quot;layerName&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;points&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">&quot;asWKB&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;file:///tmp/points.geojson&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
<span class="o">+--------------------+-------+-----+-----------------+-----------+</span>
<span class="o">|</span><span class="w">             </span><span class="n">field_1</span><span class="o">|</span><span class="n">field_2</span><span class="o">|</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="n">geom_1</span><span class="o">|</span><span class="n">geom_1_srid</span><span class="o">|</span>
<span class="o">+--------------------+-------+-----+-----------------+-----------+</span>
<span class="o">|</span><span class="w">       </span><span class="s">&quot;description&quot;</span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="o">|</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nc">POINT</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">4326</span><span class="o">|</span>
<span class="o">|</span><span class="w">       </span><span class="s">&quot;description&quot;</span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="o">|</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nc">POINT</span><span class="w"> </span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="mf">2.0</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">4326</span><span class="o">|</span>
<span class="o">|</span><span class="w">       </span><span class="s">&quot;description&quot;</span><span class="o">|</span><span class="w">      </span><span class="mi">3</span><span class="o">|</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nc">POINT</span><span class="w"> </span><span class="p">(</span><span class="mf">3.0</span><span class="w"> </span><span class="mf">3.0</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">4326</span><span class="o">|</span>
<span class="o">+--------------------+-------+-----+-----------------+-----------+</span>
</pre></div>
</div>
</div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All options are converted to a <code class="code docutils literal notranslate"><span class="pre">Map&lt;String,String&gt;</span></code> and must be supplied as a <code class="code docutils literal notranslate"><span class="pre">String</span></code>.</p>
</div>
</section>
<section id="spark-read-format-geo-db">
<h3>spark.read.format(“geo_db”)<a class="headerlink" href="#spark-read-format-geo-db" title="Permalink to this heading"></a></h3>
<p>Mosaic provides a reader for GeoDB files natively in Spark.
The output of the reader is a DataFrame with inferred schema.
Only 1 file per task is read. For parallel reading of large files use the multi_read_ogr reader.
The reader supports the following options:</p>
<blockquote>
<div><ul class="simple">
<li><p>asWKB - if the geometry should be returned as WKB (BooleanType) - default is false</p></li>
<li><p>layerName - name of the layer to read (StringType)</p></li>
<li><p>layerNumber - number of the layer to read (IntegerType), zero-indexed</p></li>
<li><p>vsizip - if the vector files are zipped files, set this to true (BooleanType)</p></li>
</ul>
</div></blockquote>
<dl class="py function">
<dt class="sig sig-object py" id="spark.read.format-geo_db-.load">
<span class="sig-prename descclassname"><span class="pre">spark.read.format(&quot;geo_db&quot;).</span></span><span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#spark.read.format-geo_db-.load" title="Permalink to this definition"></a></dt>
<dd><p>Loads a GeoDB file and returns the result as a <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>path</strong> (<em>Column</em><em>(</em><em>StringType</em><em>)</em>) – the path of the GeoDB file</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</dd>
<dt class="field-odd">Example<span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
</dd></dl>

<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-2-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-2-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-2-U2NhbGE=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-2-U2NhbGE=" name="U2NhbGE=" role="tab" tabindex="-1">Scala</button></div><div aria-labelledby="tab-2-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" id="panel-2-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;geo_db&quot;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;layerName&quot;</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;asWKB&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;file:///tmp/points.geodb&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="o">+--------------------+-------+-----+-----------------+-----------+</span>
<span class="o">|</span>             <span class="n">field_1</span><span class="o">|</span><span class="n">field_2</span><span class="o">|</span> <span class="o">...</span> <span class="o">|</span>           <span class="n">geom_1</span><span class="o">|</span><span class="n">geom_1_srid</span><span class="o">|</span>
<span class="o">+--------------------+-------+-----+-----------------+-----------+</span>
<span class="o">|</span>       <span class="s2">&quot;description&quot;</span><span class="o">|</span>      <span class="mi">1</span><span class="o">|</span> <span class="o">...</span> <span class="o">|</span> <span class="n">POINT</span> <span class="p">(</span><span class="mf">1.0</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">|</span>       <span class="mi">4326</span><span class="o">|</span>
<span class="o">|</span>       <span class="s2">&quot;description&quot;</span><span class="o">|</span>      <span class="mi">2</span><span class="o">|</span> <span class="o">...</span> <span class="o">|</span> <span class="n">POINT</span> <span class="p">(</span><span class="mf">2.0</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">|</span>       <span class="mi">4326</span><span class="o">|</span>
<span class="o">|</span>       <span class="s2">&quot;description&quot;</span><span class="o">|</span>      <span class="mi">3</span><span class="o">|</span> <span class="o">...</span> <span class="o">|</span> <span class="n">POINT</span> <span class="p">(</span><span class="mf">3.0</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">|</span>       <span class="mi">4326</span><span class="o">|</span>
<span class="o">+--------------------+-------+-----+-----------------+-----------+</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-2-U2NhbGE=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-2-U2NhbGE=" name="U2NhbGE=" role="tabpanel" tabindex="0"><div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;geo_db&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">&quot;layerName&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;points&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">&quot;asWKB&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;file:///tmp/points.geodb&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
<span class="o">+--------------------+-------+-----+-----------------+-----------+</span>
<span class="o">|</span><span class="w">             </span><span class="n">field_1</span><span class="o">|</span><span class="n">field_2</span><span class="o">|</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="n">geom_1</span><span class="o">|</span><span class="n">geom_1_srid</span><span class="o">|</span>
<span class="o">+--------------------+-------+-----+-----------------+-----------+</span>
<span class="o">|</span><span class="w">       </span><span class="s">&quot;description&quot;</span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="o">|</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nc">POINT</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">4326</span><span class="o">|</span>
<span class="o">|</span><span class="w">       </span><span class="s">&quot;description&quot;</span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="o">|</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nc">POINT</span><span class="w"> </span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="mf">2.0</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">4326</span><span class="o">|</span>
<span class="o">|</span><span class="w">       </span><span class="s">&quot;description&quot;</span><span class="o">|</span><span class="w">      </span><span class="mi">3</span><span class="o">|</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nc">POINT</span><span class="w"> </span><span class="p">(</span><span class="mf">3.0</span><span class="w"> </span><span class="mf">3.0</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">4326</span><span class="o">|</span>
<span class="o">+--------------------+-------+-----+-----------------+-----------+</span>
</pre></div>
</div>
</div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Keyword options not identified in function signature are converted to a <code class="code docutils literal notranslate"><span class="pre">Map&lt;String,String&gt;</span></code>.
These must be supplied as a <code class="code docutils literal notranslate"><span class="pre">String</span></code>.
Also, you can supply function signature values as <code class="code docutils literal notranslate"><span class="pre">String</span></code>.</p>
</div>
</section>
<section id="spark-read-format-shapefile">
<h3>spark.read.format(“shapefile”)<a class="headerlink" href="#spark-read-format-shapefile" title="Permalink to this heading"></a></h3>
<p>Mosaic provides a reader for Shapefiles natively in Spark.
The output of the reader is a DataFrame with inferred schema.
Only 1 file per task is read. For parallel reading of large files use the multi_read_ogr reader.
The reader supports the following options:</p>
<blockquote>
<div><ul class="simple">
<li><p>asWKB - if the geometry should be returned as WKB (BooleanType) - default is false</p></li>
<li><p>layerName - name of the layer to read (StringType)</p></li>
<li><p>layerNumber - number of the layer to read (IntegerType), zero-indexed</p></li>
<li><p>vsizip - if the vector files are zipped files, set this to true (BooleanType)</p></li>
</ul>
</div></blockquote>
<dl class="py function">
<dt class="sig sig-object py" id="spark.read.format-shapefile-.load">
<span class="sig-prename descclassname"><span class="pre">spark.read.format(&quot;shapefile&quot;).</span></span><span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#spark.read.format-shapefile-.load" title="Permalink to this definition"></a></dt>
<dd><p>Loads a Shapefile and returns the result as a <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>path</strong> (<em>Column</em><em>(</em><em>StringType</em><em>)</em>) – the path of the Shapefile</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</dd>
<dt class="field-odd">Example<span class="colon">:</span></dt>
<dd class="field-odd"><p></p></dd>
</dl>
</dd></dl>

<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" role="tablist"><button aria-controls="panel-3-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-3-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-3-U2NhbGE=" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-3-U2NhbGE=" name="U2NhbGE=" role="tab" tabindex="-1">Scala</button></div><div aria-labelledby="tab-3-UHl0aG9u" class="sphinx-tabs-panel code-tab group-tab" id="panel-3-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;shapefile&quot;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;layerName&quot;</span><span class="p">,</span> <span class="s2">&quot;points&quot;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;asWKB&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;file:///tmp/points.shp&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="o">+--------------------+-------+-----+-----------------+-----------+</span>
<span class="o">|</span>             <span class="n">field_1</span><span class="o">|</span><span class="n">field_2</span><span class="o">|</span> <span class="o">...</span> <span class="o">|</span>           <span class="n">geom_1</span><span class="o">|</span><span class="n">geom_1_srid</span><span class="o">|</span>
<span class="o">+--------------------+-------+-----+-----------------+-----------+</span>
<span class="o">|</span>       <span class="s2">&quot;description&quot;</span><span class="o">|</span>      <span class="mi">1</span><span class="o">|</span> <span class="o">...</span> <span class="o">|</span> <span class="n">POINT</span> <span class="p">(</span><span class="mf">1.0</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">|</span>       <span class="mi">4326</span><span class="o">|</span>
<span class="o">|</span>       <span class="s2">&quot;description&quot;</span><span class="o">|</span>      <span class="mi">2</span><span class="o">|</span> <span class="o">...</span> <span class="o">|</span> <span class="n">POINT</span> <span class="p">(</span><span class="mf">2.0</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">|</span>       <span class="mi">4326</span><span class="o">|</span>
<span class="o">|</span>       <span class="s2">&quot;description&quot;</span><span class="o">|</span>      <span class="mi">3</span><span class="o">|</span> <span class="o">...</span> <span class="o">|</span> <span class="n">POINT</span> <span class="p">(</span><span class="mf">3.0</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">|</span>       <span class="mi">4326</span><span class="o">|</span>
<span class="o">+--------------------+-------+-----+-----------------+-----------+</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-3-U2NhbGE=" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-3-U2NhbGE=" name="U2NhbGE=" role="tabpanel" tabindex="0"><div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="kd">val</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;shapefile&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">&quot;layerName&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;points&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">&quot;asWKB&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;file:///tmp/points.shp&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
<span class="o">+--------------------+-------+-----+-----------------+-----------+</span>
<span class="o">|</span><span class="w">             </span><span class="n">field_1</span><span class="o">|</span><span class="n">field_2</span><span class="o">|</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">|</span><span class="w">           </span><span class="n">geom_1</span><span class="o">|</span><span class="n">geom_1_srid</span><span class="o">|</span>
<span class="o">+--------------------+-------+-----+-----------------+-----------+</span>
<span class="o">|</span><span class="w">       </span><span class="s">&quot;description&quot;</span><span class="o">|</span><span class="w">      </span><span class="mi">1</span><span class="o">|</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nc">POINT</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">4326</span><span class="o">|</span>
<span class="o">|</span><span class="w">       </span><span class="s">&quot;description&quot;</span><span class="o">|</span><span class="w">      </span><span class="mi">2</span><span class="o">|</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nc">POINT</span><span class="w"> </span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="mf">2.0</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">4326</span><span class="o">|</span>
<span class="o">|</span><span class="w">       </span><span class="s">&quot;description&quot;</span><span class="o">|</span><span class="w">      </span><span class="mi">3</span><span class="o">|</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nc">POINT</span><span class="w"> </span><span class="p">(</span><span class="mf">3.0</span><span class="w"> </span><span class="mf">3.0</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">4326</span><span class="o">|</span>
<span class="o">+--------------------+-------+-----+-----------------+-----------+</span>
</pre></div>
</div>
</div></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Keyword options not identified in function signature are converted to a <code class="code docutils literal notranslate"><span class="pre">Map&lt;String,String&gt;</span></code>.
These must be supplied as a <code class="code docutils literal notranslate"><span class="pre">String</span></code>.
Also, you can supply function signature values as <code class="code docutils literal notranslate"><span class="pre">String</span></code>.</p>
</div>
</section>
</section>
<section id="vector-file-udfs">
<h2>Vector File UDFs<a class="headerlink" href="#vector-file-udfs" title="Permalink to this heading"></a></h2>
<p>It can be of use to perform various exploratory operations on vector file formats to help with processing.
The following UDFs use <a class="reference external" href="https://fiona.readthedocs.io/en/stable/index.html">fiona</a> which is already provided
as part of the dependencies of Mosaic python bindings.</p>
<p>We are showing the zipped variation for a larger (800MB) shapefile.
This is just one file for example purposes; you can have any number of files in real-world use.
Here is a snippet for downloading.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%sh
mkdir<span class="w"> </span>-p<span class="w"> </span>/dbfs/home/&lt;username&gt;/data/large_shapefiles
wget<span class="w"> </span>-nv<span class="w"> </span>-P<span class="w"> </span>/dbfs/home/&lt;username&gt;/data/large_shapefiles<span class="w"> </span>-nc<span class="w"> </span>https://osmdata.openstreetmap.de/download/land-polygons-split-4326.zip
ls<span class="w"> </span>-lh<span class="w"> </span>/dbfs/home/&lt;username&gt;/data/large_shapefiles
</pre></div>
</div>
<p>Then we create a spark dataframe made up of metadata to drive the examples.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>
  <span class="p">{</span>
    <span class="s1">&#39;rel_path&#39;</span><span class="p">:</span> <span class="s1">&#39;/land-polygons-split-4326/land_polygons.shp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;driver&#39;</span><span class="p">:</span> <span class="s1">&#39;ESRI Shapefile&#39;</span><span class="p">,</span>
    <span class="s1">&#39;zip_path&#39;</span><span class="p">:</span> <span class="s1">&#39;/dbfs/home/&lt;username&gt;/data/large_shapefiles/land-polygons-split-4326.zip&#39;</span>
  <span class="p">}</span>
<span class="p">])</span>
</pre></div>
</div>
<p>Here is an example UDF to list layers, supporting both zipped and non-zipped.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">udf</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="o">*</span>

<span class="nd">@udf</span><span class="p">(</span><span class="n">returnType</span><span class="o">=</span><span class="n">ArrayType</span><span class="p">(</span><span class="n">StringType</span><span class="p">()))</span>
<span class="k">def</span> <span class="nf">list_layers</span><span class="p">(</span><span class="n">in_path</span><span class="p">,</span> <span class="n">driver</span><span class="p">,</span> <span class="n">zip_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  List layer names (in index order).</span>
<span class="sd">   - in_path: file location for read; when used with `zip_path`,</span>
<span class="sd">      this will be the relative path within a zip to open</span>
<span class="sd">   - driver: name of GDAL driver to use</span>
<span class="sd">   - zip_path: follows format &#39;zip:///some/file.zip&#39; (Optional, default is None); zip gets opened something like:</span>
<span class="sd">      `with fiona.open(&#39;/test/a.shp&#39;, vfs=&#39;zip:///tmp/dir1/test.zip&#39;, driver=&#39;&lt;driver&gt;&#39;) as f:`</span>
<span class="sd">      Note: you can prepend &#39;zip://&#39; for the param or leave it off in this example</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="kn">import</span> <span class="nn">fiona</span>

  <span class="n">z_path</span> <span class="o">=</span> <span class="n">zip_path</span>
  <span class="k">if</span> <span class="n">zip_path</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">zip_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;zip:&quot;</span><span class="p">):</span>
    <span class="n">z_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;zip://</span><span class="si">{</span><span class="n">zip_path</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">return</span> <span class="n">fiona</span><span class="o">.</span><span class="n">listlayers</span><span class="p">(</span><span class="n">in_path</span><span class="p">,</span> <span class="n">vfs</span><span class="o">=</span><span class="n">z_path</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="n">driver</span><span class="p">)</span>
</pre></div>
</div>
<p>We can call the UDF, e.g.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyspark.sql.functions</span> <span class="k">as</span> <span class="nn">F</span>

<span class="n">display</span><span class="p">(</span>
  <span class="n">df</span>
    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
      <span class="s2">&quot;layers&quot;</span><span class="p">,</span>
      <span class="n">list_layers</span><span class="p">(</span><span class="s2">&quot;rel_path&quot;</span><span class="p">,</span> <span class="s2">&quot;driver&quot;</span><span class="p">,</span> <span class="s2">&quot;zip_path&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;num_layers&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="s2">&quot;layers&quot;</span><span class="p">))</span>
<span class="p">)</span>
<span class="o">+--------------+--------------------+--------------------+---------------+----------+</span>
<span class="o">|</span>        <span class="n">driver</span><span class="o">|</span>            <span class="n">rel_path</span><span class="o">|</span>            <span class="n">zip_path</span><span class="o">|</span>         <span class="n">layers</span><span class="o">|</span><span class="n">num_layers</span><span class="o">|</span>
<span class="o">+--------------+--------------------+--------------------+---------------+----------+</span>
<span class="o">|</span><span class="n">ESRI</span> <span class="n">Shapefile</span><span class="o">|/</span><span class="n">land</span><span class="o">-</span><span class="n">polygons</span><span class="o">-</span><span class="n">sp</span><span class="o">...|/</span><span class="n">dbfs</span><span class="o">/</span><span class="n">home</span><span class="o">/...</span>      <span class="o">|</span><span class="p">[</span><span class="n">land_polygons</span><span class="p">]</span><span class="o">|</span>         <span class="mi">1</span><span class="o">|</span>
<span class="o">+--------------+--------------------+--------------------+---------------+----------+</span>
</pre></div>
</div>
<p>Here is an example UDF to count rows for a layer, supporting both zipped and non-zipped.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">udf</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">IntegerType</span>

<span class="nd">@udf</span><span class="p">(</span><span class="n">returnType</span><span class="o">=</span><span class="n">IntegerType</span><span class="p">())</span>
<span class="k">def</span> <span class="nf">count_vector_rows</span><span class="p">(</span><span class="n">in_path</span><span class="p">,</span> <span class="n">driver</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">zip_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Count rows for the provided vector file.</span>
<span class="sd">   - in_path: file location for read; when used with `zip_path`,</span>
<span class="sd">      this will be the relative path within a zip to open</span>
<span class="sd">   - driver: name of GDAL driver to use</span>
<span class="sd">   - layer: integer (zero-indexed) or string (name)</span>
<span class="sd">   - zip_path: follows format &#39;zip:///some/file.zip&#39; (Optional, default is None); zip gets opened something like:</span>
<span class="sd">      `with fiona.open(&#39;/test/a.shp&#39;, vfs=&#39;zip:///tmp/dir1/test.zip&#39;, driver=&#39;&lt;driver&gt;&#39;) as f:`</span>
<span class="sd">      Note: you can prepend &#39;zip://&#39; for the param or leave it off in this example</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="kn">import</span> <span class="nn">fiona</span>

  <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">z_path</span> <span class="o">=</span> <span class="n">zip_path</span>
  <span class="k">if</span> <span class="n">zip_path</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">zip_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;zip:&quot;</span><span class="p">):</span>
    <span class="n">z_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;zip://</span><span class="si">{</span><span class="n">zip_path</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">with</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">in_path</span><span class="p">,</span> <span class="n">vfs</span><span class="o">=</span><span class="n">z_path</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="n">driver</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span> <span class="k">as</span> <span class="n">in_file</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">in_file</span><span class="p">:</span>
      <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="k">return</span> <span class="n">cnt</span>
</pre></div>
</div>
<p>We can call the UDF, e.g.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyspark.sql.functions</span> <span class="k">as</span> <span class="nn">F</span>

<span class="n">display</span><span class="p">(</span>
  <span class="n">df</span>
    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
      <span class="s2">&quot;row_cnt&quot;</span><span class="p">,</span>
      <span class="n">count_vector_rows</span><span class="p">(</span><span class="s2">&quot;rel_path&quot;</span><span class="p">,</span> <span class="s2">&quot;driver&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;zip_path&quot;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="o">+--------------+--------------------+--------------------+-------+</span>
<span class="o">|</span>        <span class="n">driver</span><span class="o">|</span>            <span class="n">rel_path</span><span class="o">|</span>            <span class="n">zip_path</span><span class="o">|</span><span class="n">row_cnt</span><span class="o">|</span>
<span class="o">+--------------+--------------------+--------------------+-------+</span>
<span class="o">|</span><span class="n">ESRI</span> <span class="n">Shapefile</span><span class="o">|/</span><span class="n">land</span><span class="o">-</span><span class="n">polygons</span><span class="o">-</span><span class="n">sp</span><span class="o">...|/</span><span class="n">dbfs</span><span class="o">/</span><span class="n">home</span><span class="o">/...</span>      <span class="o">|</span> <span class="mi">789972</span><span class="o">|</span>
<span class="o">+--------------+--------------------+--------------------+-------+</span>
</pre></div>
</div>
<p>Here is an example UDF to get spark friendly schema for a layer, supporting both zipped and non-zipped.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">udf</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">StringType</span>

<span class="nd">@udf</span><span class="p">(</span><span class="n">returnType</span><span class="o">=</span><span class="n">StringType</span><span class="p">())</span>
<span class="k">def</span> <span class="nf">layer_schema</span><span class="p">(</span><span class="n">in_path</span><span class="p">,</span> <span class="n">driver</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">zip_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Get the schema for the provided vector file layer.</span>
<span class="sd">   - in_path: file location for read; when used with `zip_path`,</span>
<span class="sd">      this will be the relative path within a zip to open</span>
<span class="sd">   - driver: name of GDAL driver to use</span>
<span class="sd">   - layer: integer (zero-indexed) or string (name)</span>
<span class="sd">   - zip_path: follows format &#39;zip:///some/file.zip&#39; (Optional, default is None); zip gets opened something like:</span>
<span class="sd">      `with fiona.open(&#39;/test/a.shp&#39;, vfs=&#39;zip:///tmp/dir1/test.zip&#39;, driver=&#39;&lt;driver&gt;&#39;) as f:`</span>
<span class="sd">      Note: you can prepend &#39;zip://&#39; for the param or leave it off in this example</span>
<span class="sd">  Returns layer schema json as string</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="kn">import</span> <span class="nn">fiona</span>
  <span class="kn">import</span> <span class="nn">json</span>

  <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">z_path</span> <span class="o">=</span> <span class="n">zip_path</span>
  <span class="k">if</span> <span class="n">zip_path</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">zip_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;zip:&quot;</span><span class="p">):</span>
    <span class="n">z_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;zip://</span><span class="si">{</span><span class="n">zip_path</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">with</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">in_path</span><span class="p">,</span> <span class="n">vfs</span><span class="o">=</span><span class="n">z_path</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="n">driver</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span> <span class="k">as</span> <span class="n">in_file</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">in_file</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</pre></div>
</div>
<p>We can call the UDF, e.g.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyspark.sql.functions</span> <span class="k">as</span> <span class="nn">F</span>

<span class="n">display</span><span class="p">(</span>
  <span class="n">df</span>
    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
      <span class="s2">&quot;layer_schema&quot;</span><span class="p">,</span>
      <span class="n">layer_schema</span><span class="p">(</span><span class="s2">&quot;rel_path&quot;</span><span class="p">,</span> <span class="s2">&quot;driver&quot;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;zip_path&quot;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="o">+--------------+--------------------+--------------------+--------------------+</span>
<span class="o">|</span>        <span class="n">driver</span><span class="o">|</span>            <span class="n">rel_path</span><span class="o">|</span>            <span class="n">zip_path</span><span class="o">|</span>        <span class="n">layer_schema</span><span class="o">|</span>
<span class="o">+--------------+--------------------+--------------------+--------------------+</span>
<span class="o">|</span><span class="n">ESRI</span> <span class="n">Shapefile</span><span class="o">|/</span><span class="n">land</span><span class="o">-</span><span class="n">polygons</span><span class="o">-</span><span class="n">sp</span><span class="o">...|/</span><span class="n">dbfs</span><span class="o">/</span><span class="n">home</span><span class="o">/...</span>      <span class="o">|</span><span class="p">{</span><span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;...|</span>
<span class="o">+--------------+--------------------+--------------------+--------------------+</span>
</pre></div>
</div>
<p>Also, it can be useful to standardize collections of zipped vector formats to ensure all are individually zipped to work
with the provided APIs.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Option <cite>vsizip</cite> in the Mosaic GDAL APIs (different API than the above fiona UDF examples) is for individually zipped
vector files (.e.g File Geodatabase or Shapefile), not collections. If you end up with mixed or unclear zipped files,
you can test them with a UDF such as shown below.</p>
</div>
<p>Here is an example UDF to test for zip of zips.
In this example, we can use <code class="code docutils literal notranslate"><span class="pre">zip_path</span></code> from <code class="code docutils literal notranslate"><span class="pre">df</span></code> because we left “zip://” out of the name.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">udf</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">BooleanType</span>

<span class="nd">@udf</span><span class="p">(</span><span class="n">returnType</span><span class="o">=</span><span class="n">BooleanType</span><span class="p">())</span>
<span class="k">def</span> <span class="nf">test_double_zip</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Tests whether a zip contains zips, which is not supported by</span>
<span class="sd">  Mosaic GDAL APIs.</span>
<span class="sd">   - path: to check</span>
<span class="sd">  Returns boolean</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="kn">import</span> <span class="nn">zipfile</span>

  <span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="nb">zip</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">zip</span><span class="o">.</span><span class="n">namelist</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.zip&quot;</span><span class="p">):</span>
          <span class="k">return</span> <span class="kc">True</span>
      <span class="k">return</span> <span class="kc">False</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
<p>We can call the UDF, e.g.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span>
  <span class="n">df</span>
    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
      <span class="s2">&quot;is_double_zip&quot;</span><span class="p">,</span>
      <span class="n">test_double_zip</span><span class="p">(</span><span class="s2">&quot;zip_path&quot;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="o">+--------------------+-------------+</span>
<span class="o">|</span>            <span class="n">zip_path</span><span class="o">|</span><span class="n">is_double_zip</span><span class="o">|</span>
<span class="o">+--------------------+-------------+</span>
<span class="o">|/</span><span class="n">dbfs</span><span class="o">/</span><span class="n">home</span><span class="o">/...</span>      <span class="o">|</span>        <span class="n">false</span><span class="o">|</span>
<span class="o">+--------------------+-------------+</span>
</pre></div>
</div>
<p>Though not shown here, you can then handle unzipping the “double” zips that return <cite>True</cite> by extending
<code class="code docutils literal notranslate"><span class="pre">test_double_zip</span></code> UDF to perform unzips (with a provided out_dir) or through an additional UDF, e.g. using ZipFile
<a class="reference external" href="https://docs.python.org/3/library/zipfile.html#zipfile.ZipFile.extractall">extractall</a> function.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="api.html" class="btn btn-neutral float-left" title="API Documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="raster-format-readers.html" class="btn btn-neutral float-right" title="Raster Format Readers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Databricks Inc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>